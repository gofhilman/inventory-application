<main class="index">
  <div class="filter">
    <p>Filter by</p>
    <form action="/">
      <div>
        <label for="category">Category</label>
        <select name="category" id="category">
          <option value="">all categories</option>
          <% filters.categories.forEach((item) => { %>
          <option value=<%= item.id %> <%= item.id === indexQuery.category ? "selected" : "" %>><%= item.name %></option>
          <% }); %>
        </select>
      </div>
      <div>
        <label for="language">Language</label>
        <select name="language" id="language">
          <option value="">all languages</option>
          <% filters.languages.forEach((item) => { %>
          <option value=<%= item.id %> <%= item.id === indexQuery.language ? "selected" : "" %>><%= item.name %></option>
          <% }); %>
        </select>
      </div>
      <div>
        <label for="tool">Tool</label>
        <select name="tool" id="tool">
          <option value="">all tools</option>
          <% filters.tools.forEach((item) => { %>
          <option value=<%= item.id %> <%= item.id === indexQuery.tool ? "selected" : "" %>><%= item.name %></option>
          <% }); %>
        </select>
      </div>
      <input type="hidden" name="page" value="1">
      <button>Apply</button>
    </form>
  </div>
  <div class="list">
    <% const categoryName = indexQuery.category ? 
      filters.categories.find(item => item.id === indexQuery.category).name : "All categories"; %>
    <h2><%= categoryName[0].toUpperCase() + categoryName.slice(1) %></h2>
    <p class="item-number"><%= filteredProjectNumber %> items found</p>
    <div class="cards">
      <% compartedProjects.forEach((item) => { %>
      <article>
        <a href=<%= `/project/${item.project_id}` %>>
          <% if(item.image) { %>
            <img src=<%= item.image %> alt="Project image">
          <% } else { %>
            <div></div>
          <% }; %> 
        </a>
        <div>
          <a href=<%= `/project/${item.project_id}` %>>
            <h3><%= item.name %></h3>
            <div class="category">
              <p>Category:</p>
              <div>
                <% item.category.forEach((element) => { %>
                <p><%= element %></p>
                <% }); %>
              </div>
            </div>
            <p><%= item.description %></p>
          </a>
          <p>Source code: <a href=<%= item.source %> target="_blank" rel="noopener noreferrer"><%= item.source %></a></p>
        </div>
      </article>
      <% }); %>
    </div>
    <div class="pagination">
      <% Object.keys(indexQuery).forEach(key => {
        if(!indexQuery[key]) indexQuery[key] = "";
      }); %>
      <a href=<%= `/?category=${indexQuery.category}&language=${indexQuery.language}&tool=${indexQuery.tool}&page=${indexQuery.page - 1}` %>
        class=<%= indexQuery.page === 1 ? "disable" : "" %>>
        <img src="/images/chevron-left.svg" alt="">
      </a>
      <p><%= indexQuery.page %></p>
      <a href=<%= `/?category=${indexQuery.category}&language=${indexQuery.language}&tool=${indexQuery.tool}&page=${indexQuery.page + 1}` %>
        class=<%= indexQuery.page >= Math.floor((filteredProjectNumber - 1) / 10) + 1 ? "disable" : "" %>>
        <img src="/images/chevron-right.svg" alt="">
      </a>
    </div>
  </div>
</main>
